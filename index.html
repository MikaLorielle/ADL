<button id="startBtn">Start & Download GIF</button>
<img id="logo-preview" src="ORCC.png" style="width:40px;height:40px"/>

<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>
<script>
document.getElementById('startBtn').addEventListener('click', async () => {
  const CANVAS_SIZE = 256;       // smaller for phones
  const FPS = 15;               // lower fps
  const SPIN_SEC = 1.5;
  const PAUSE_SEC = 1;
  const FRAMES_PER_SPIN = Math.round(FPS * SPIN_SEC);
  const FRAMES_PAUSE = Math.round(FPS * PAUSE_SEC);
  const DELAY = Math.round(1000 / FPS);

  // offscreen canvas
  const off = document.createElement('canvas');
  off.width = CANVAS_SIZE; off.height = CANVAS_SIZE;
  const ctx = off.getContext('2d');

  // preload logo with crossOrigin if served with CORS
  const logo = new Image();
  logo.crossOrigin = 'anonymous'; // only effective if server sends CORS header
  logo.src = 'Img.PNG';

  await new Promise(r => logo.onload = r);

  const seq = [
    {start: logo, end: 'üêà'},
    {start: 'üêà', end: 'ü©∑'},
    {start: 'ü©∑', end: logo}
  ];

  const gif = new GIF({
    workers: 1,
    quality: 4,                // higher number = faster / smaller, lower quality
    width: CANVAS_SIZE,
    height: CANVAS_SIZE,
    transparent: 'rgba(0,0,0,0)',
    workerScript: 'https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.worker.js'
  });

  let totalFrames = seq.length * (FRAMES_PER_SPIN + FRAMES_PAUSE), added=0;
  function addFrame(delay) {
    gif.addFrame(ctx, {copy:true, delay});
    added++;
    // optionally update UI: percent = Math.round(added/totalFrames*100)
  }

  function easeInOut(t) {
    return t < 0.5 ? 2*t*t : -1 + (4 - 2*t)*t;
  }

  function draw(content, angle) {
    ctx.clearRect(0,0,CANVAS_SIZE,CANVAS_SIZE);
    ctx.save();
    ctx.translate(CANVAS_SIZE/2, CANVAS_SIZE/2);
    ctx.rotate(angle * Math.PI/180);
    if (typeof content === 'string') {
      ctx.font = Math.floor(CANVAS_SIZE * 0.72) + 'px "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", sans-serif';
      ctx.textAlign='center'; ctx.textBaseline='middle';
      ctx.fillStyle = 'black'; // or another color
      ctx.fillText(content, 0, 0);
    } else {
      ctx.drawImage(content, -CANVAS_SIZE/2, -CANVAS_SIZE/2, CANVAS_SIZE, CANVAS_SIZE);
    }
    ctx.restore();
    // small preview update
    document.getElementById('logo-preview').src = off.toDataURL();
  }

  // build frames
  for (const step of seq) {
    for (let f=0; f<FRAMES_PER_SPIN; f++) {
      const t = f / Math.max(1, FRAMES_PER_SPIN-1);
      const a = easeInOut(t) * 360;
      const content = a >= 180 ? step.end : step.start;
      draw(content, a);
      addFrame(DELAY);
      // allow UI to breathe on mobile
      await new Promise(r => setTimeout(r, 0));
    }
    // pause
    for (let p=0; p<FRAMES_PAUSE; p++) {
      draw(step.end, 0);
      addFrame(DELAY);
      await new Promise(r => setTimeout(r, 0));
    }
  }

  gif.on('finished', (blob) => {
    // Android: will download
    // iOS: may open in a new tab ‚Äî user may need to long-press to save
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'orcat_spin.gif';
    document.body.appendChild(a);
    a.click();
    a.remove();
  });

  gif.render();
});
</script>